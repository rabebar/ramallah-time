<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <script>
    // 1. Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø§Ù„Ø§Ø³ØªØ¨Ø§Ù‚ÙŠ Ù„Ù…Ù†Ø¹ Ø¸Ù‡ÙˆØ± Ø§Ù„ØµÙØ­Ø© Ù‚Ø¨Ù„ Ø§Ù„ØªØ­Ù‚Ù‚
    document.documentElement.style.display = 'none';
    (async function verifyAccess() {
        const token = sessionStorage.getItem("admin_token");
        if (!token) { window.location.replace("/static/admin-login.html"); return; }
        try {
            const res = await fetch("/api/admin/verify", { headers: { "x-admin-token": token } });
            if (res.ok) { document.documentElement.style.display = 'block'; } 
            else { throw new Error(); }
        } catch (err) {
            sessionStorage.removeItem("admin_token");
            window.location.replace("/static/admin-login.html");
        }
    })();
  </script>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø© | Ramallah Time</title>
  
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&display=swap" rel="stylesheet">
  
  <style>
    :root {
      --bg: #020617; --card: #0f172a; --primary: #3b82f6; --success: #10b981;
      --warning: #f59e0b; --danger: #ef4444; --border: rgba(255, 255, 255, 0.08);
      --text: #f8fafc; --text-dim: #94a3b8;
    }
    body {
      background: var(--bg); font-family: 'Cairo', sans-serif;
      margin: 0; padding: 0; color: var(--text); overflow-x: hidden;
      display: flex; min-height: 100vh;
    }
    .sidebar {
      width: 260px; background: var(--card); border-left: 1px solid var(--border);
      display: flex; flex-direction: column; position: fixed; height: 100vh; right: 0; z-index: 100;
    }
    .sidebar-header { padding: 30px 20px; text-align: center; border-bottom: 1px solid var(--border); }
    .menu-item {
      padding: 15px 25px; display: flex; align-items: center; gap: 15px;
      color: var(--text-dim); text-decoration: none; font-weight: 700; transition: 0.3s;
    }
    .menu-item:hover, .menu-item.active { background: rgba(59, 130, 246, 0.1); color: var(--primary); border-right: 4px solid var(--primary); }
    .main-content { margin-right: 260px; flex-grow: 1; padding: 30px; width: calc(100% - 260px); }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(240px, 1fr)); gap: 20px; margin-bottom: 30px; }
    .stat-card {
      background: var(--card); padding: 25px; border-radius: 20px; border: 1px solid var(--border);
      position: relative; overflow: hidden; text-align: center;
    }
    .table-container { background: var(--card); border-radius: 24px; border: 1px solid var(--border); overflow: hidden; }
    table { width: 100%; border-collapse: collapse; }
    th { background: rgba(255,255,255,0.02); padding: 18px 25px; text-align: right; color: var(--text-dim); font-size: 13px; font-weight: 800; }
    td { padding: 18px 25px; border-bottom: 1px solid var(--border); font-size: 14px; font-weight: 700; }
    .badge { padding: 6px 12px; border-radius: 10px; font-size: 12px; font-weight: 900; }
    .bg-pending { background: rgba(245, 158, 11, 0.15); color: var(--warning); }
    .bg-active { background: rgba(16, 185, 129, 0.15); color: var(--success); }
    .modal {
      position: fixed; inset: 0; background: rgba(0,0,0,0.9);
      display: none; align-items: center; justify-content: center; z-index: 2000; backdrop-filter: blur(10px); padding: 20px;
    }
    .modal-content {
      background: var(--card); padding: 35px; border-radius: 28px; width: 100%; max-width: 850px;
      border: 1px solid var(--border); max-height: 90vh; overflow-y: auto;
    }
    .modal-input {
      width: 100%; height: 50px; background: var(--bg); border: 1px solid var(--border);
      border-radius: 12px; color: white; padding: 0 15px; margin-bottom: 12px; font-family: inherit; box-sizing: border-box;
    }
    .stat-label { color: var(--text-dim); font-size: 13px; font-weight: 700; display: block; margin-bottom: 5px; }
    .btn-action { padding: 8px 12px; border-radius: 10px; border: none; cursor: pointer; font-size: 14px; transition: 0.2s; }
  </style>
</head>
<body>

  <!-- Ø§Ù„Ø´Ø±ÙŠØ· Ø§Ù„Ø¬Ø§Ù†Ø¨ÙŠ (Sidebar) -->
  <aside class="sidebar">
    <div class="sidebar-header">
      <h2 style="color: var(--primary); font-weight: 900; margin: 0;">Ø±Ø§Ù… Ø§Ù„Ù„Ù‡ ØªØ§ÙŠÙ…</h2>
      <p style="font-size: 12px; color: var(--text-dim); margin: 5px 0 0;">Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø´Ø§Ù…Ù„Ø©</p>
    </div>
    
    <nav style="flex-grow: 1; padding: 20px 0;">
      <a href="/" class="menu-item"><i class="fa-solid fa-house"></i> Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù…ÙˆÙ‚Ø¹</a>
      <a href="#" onclick="loadData()" class="menu-item active"><i class="fa-solid fa-sync"></i> ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª</a>
    </nav>

    <div style="padding: 20px; border-top: 1px solid var(--border);">
      <button onclick="logout()" style="width:100%; padding:12px; background:rgba(239,68,68,0.1); color:var(--danger); border:1px solid var(--danger); border-radius:12px; cursor:pointer; font-weight:800; font-family:inherit;">
        <i class="fa-solid fa-power-off"></i> Ø®Ø±ÙˆØ¬ Ø¢Ù…Ù†
      </button>
    </div>
  </aside>

  <!-- Ø§Ù„Ù…Ù†Ø·Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© -->
  <main class="main-content">
    
    <!-- Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª -->
    <div class="stats-grid">
      <div class="stat-card">
        <div id="totalRevenue" style="font-size: 32px; font-weight: 900; color: var(--success);">$0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ­ØµÙŠÙ„ Ø§Ù„Ù…Ø§Ù„ÙŠ</div>
      </div>
      <div class="stat-card">
        <div id="countActive" style="font-size: 32px; font-weight: 900; color: var(--primary);">0</div>
        <div class="stat-label">Ø§Ø´ØªØ±Ø§ÙƒØ§Øª Ù†Ø´Ø·Ø©</div>
      </div>
      <div class="stat-card">
        <div id="countPending" style="font-size: 32px; font-weight: 900; color: var(--warning);">0</div>
        <div class="stat-label">Ø·Ù„Ø¨Ø§Øª Ù…Ø¹Ù„Ù‚Ø©</div>
      </div>
    </div>

    <!-- Ø§Ù„Ø¬Ø¯ÙˆÙ„ -->
    <div class="table-container">
      <div style="padding: 20px 25px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border);">
        <h3 style="margin:0; font-weight:900;">Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ù†Ø´Ø¢Øª</h3>
        <input type="text" id="adminSearch" placeholder="Ø¨Ø­Ø« Ø³Ø±ÙŠØ¹..." oninput="renderData()" style="background:rgba(255,255,255,0.05); border:1px solid var(--border); color:#fff; padding:10px 15px; border-radius:12px; width:250px; outline:none;">
      </div>

      <div style="overflow-x: auto;">
        <table>
          <thead>
            <tr>
              <th>ID</th>
              <th>Ø§Ù„Ù…Ù†Ø´Ø£Ø© ÙˆØ§Ù„Ù…Ø§Ù„Ùƒ</th>
              <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
              <th>Ø§Ù„ØªØ­ØµÙŠÙ„</th>
              <th>Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª Ø¥Ø¯Ø§Ø±ÙŠØ©</th>
            </tr>
          </thead>
          <tbody id="placesList">
            <!-- ÙŠØªÙ… Ø§Ù„ØªØ¹Ø¨Ø¦Ø© Ø¹Ø¨Ø± JS -->
          </tbody>
        </table>
      </div>
    </div>
  </main>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ø¬Ø¯Ø§Ù‹ -->
  <div id="editPlaceModal" class="modal">
    <div class="modal-content">
      <h2 style="margin-top:0; color:var(--primary); font-weight: 900; border-bottom: 1px solid var(--border); padding-bottom: 15px;">ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø©</h2>
      <input type="hidden" id="edit_id">
      
      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-top: 20px;">
        <div style="grid-column: span 2; display: flex; align-items: center; gap: 10px; background: rgba(59, 130, 246, 0.1); padding: 15px; border-radius: 12px; border: 1px solid var(--primary); margin-bottom: 5px;">
    <input type="checkbox" id="edit_is_premium" style="width: 22px; height: 22px; cursor: pointer;">
    <label for="edit_is_premium" style="font-weight: 900; color: var(--primary); cursor: pointer; margin-bottom: 0;">ğŸŒŸ ØªÙ…ÙŠÙŠØ² Ø§Ù„Ù…Ù†Ø´Ø£Ø© (Premium)</label>
</div>
        <div><label class="stat-label">Ø§Ø³Ù… Ø§Ù„Ù…ÙƒØ§Ù†:</label><input type="text" id="edit_name" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù„ØªØµÙ†ÙŠÙ:</label><input type="text" id="edit_category" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù„Ù…Ù†Ø·Ù‚Ø©:</label><input type="text" id="edit_area" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label><input type="text" id="edit_address" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù„Ù‡Ø§ØªÙ:</label><input type="text" id="edit_phone" class="modal-input"></div>
        <div><label class="stat-label">ÙˆØ§ØªØ³Ø§Ø¨:</label><input type="text" id="edit_whatsapp" class="modal-input"></div>
        <div><label class="stat-label">ÙÙŠØ³Ø¨ÙˆÙƒ:</label><input type="text" id="edit_facebook" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù†Ø³ØªØ¬Ø±Ø§Ù…:</label><input type="text" id="edit_instagram" class="modal-input"></div>
        <div><label class="stat-label">Ø§Ù„Ù…ÙˆÙ‚Ø¹ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ:</label><input type="text" id="edit_website" class="modal-input"></div>
        <div><label class="stat-label">Ø³Ø§Ø¹Ø§Øª Ø§Ù„Ø¹Ù…Ù„:</label><input type="text" id="edit_open_hours" class="modal-input"></div>
        <div><label class="stat-label">Lat (Ø®Ø· Ø¹Ø±Ø¶):</label><input type="number" step="any" id="edit_lat" class="modal-input"></div>
        <div><label class="stat-label">Lng (Ø®Ø· Ø·ÙˆÙ„):</label><input type="number" step="any" id="edit_lng" class="modal-input"></div>
      </div>
      
      <label class="stat-label" style="margin-top:10px;">ÙˆØµÙ Ø§Ù„Ù…Ù†Ø´Ø£Ø©:</label>
      <textarea id="edit_description" class="modal-input" style="height:80px; padding-top:10px;"></textarea>

      <label class="stat-label">Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© (Tags):</label>
      <input type="text" id="edit_tags" class="modal-input">

      <!-- Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„ØµÙˆØ± -->
      <div style="background: rgba(0,0,0,0.2); padding: 20px; border-radius: 15px; margin-top: 20px; border: 1px solid var(--border);">
        <h3 style="margin-top:0; font-size:15px; color:var(--success);">Ù…Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠ</h3>
        <div id="edit_images_container" style="display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 15px;"></div>
        <label class="stat-label">Ø¥Ø¶Ø§ÙØ© ØµÙˆØ± Ø¬Ø¯ÙŠØ¯Ø©:</label>
        <input type="file" id="edit_new_images" multiple class="modal-input" style="padding-top:12px;">
      </div>

      <div style="display:flex; gap:10px; margin-top:25px;">
        <button onclick="saveEdit()" style="flex:2; height:55px; background:var(--primary); color:#fff; border:none; border-radius:15px; font-weight:900; cursor:pointer;">Ø­ÙØ¸ ÙƒØ§ÙØ© Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª</button>
        <button onclick="closeEditModal()" style="flex:1; background:transparent; color:var(--text-dim); border:1px solid var(--border); border-radius:15px; cursor:pointer;">Ø¥Ù„ØºØ§Ø¡</button>
      </div>
    </div>
  </div>

  <!-- Ù†Ø§ÙØ°Ø© Ø§Ù„ØªÙØ¹ÙŠÙ„ ÙˆØ§Ù„Ù‚Ø¨Ø¶ -->
  <div id="activateModal" class="modal">
    <div class="modal-content" style="max-width: 400px;">
      <h2 style="margin:0 0 20px 0; color:var(--success);">ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ</h2>
      <input type="hidden" id="targetId">
      <label class="stat-label">Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù… ($):</label>
      <input type="number" id="subAmount" class="modal-input" placeholder="0.00">
      <label class="stat-label">Ø§Ù„Ù…Ø¯Ø©:</label>
      <select id="subMonths" class="modal-input" style="height:50px;">
        <option value="12">Ø³Ù†Ø© ÙƒØ§Ù…Ù„Ø©</option>
        <option value="6">6 Ø´Ù‡ÙˆØ±</option>
        <option value="3">3 Ø´Ù‡ÙˆØ±</option>
      </select>
      <button onclick="confirmActivation()" style="width:100%; height:50px; background:var(--success); color:#fff; border:none; border-radius:12px; font-weight:900; cursor:pointer;">ØªØ£ÙƒÙŠØ¯ ÙˆÙ‚Ø¨Ø¶ Ø§Ù„Ù…Ø§Ù„</button>
      <button onclick="closeModal()" style="width:100%; margin-top:10px; background:none; border:none; color:var(--text-dim); cursor:pointer;">Ø¥ØºÙ„Ø§Ù‚</button>
    </div>
  </div>
  <script>
    "use strict";

    const adminToken = sessionStorage.getItem("admin_token");
    let allPlaces = [];

    // 1. Ø¬Ù„Ø¨ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø´Ø§Ù…Ù„Ø© Ù…Ù† Ø§Ù„Ø³ÙŠØ±ÙØ±
    async function loadData() {
      try {
        const res = await fetch("/api/places?limit=1000&include_hidden=true", { 
          headers: { "x-admin-token": adminToken } 
        });
        const data = await res.json();
        allPlaces = data.items || [];
        calculateStats();
        renderData();
      } catch(e) { console.error("Error loading data:", e); }
    }

    // 2. Ø­Ø³Ø§Ø¨ Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ø§Ù„Ù…Ø§Ù„ÙŠØ©
    function calculateStats() {
      let rev = 0, act = 0, pen = 0;
      allPlaces.forEach(p => { 
        rev += (p.payment_total || 0); 
        if(p.subscription_status === 'pending') pen++; else act++;
      });
      document.getElementById("totalRevenue").innerText = "$" + rev.toLocaleString();
      document.getElementById("countActive").innerText = act;
      document.getElementById("countPending").innerText = pen;
    }

    // 3. Ø¹Ø±Ø¶ Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ø¹ Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ­ÙƒÙ…
    function renderData() {
      const tbody = document.getElementById("placesList");
      const q = document.getElementById("adminSearch").value.toLowerCase();
      const filtered = allPlaces.filter(p => p.name.toLowerCase().includes(q) || (p.phone && p.phone.includes(q)));
      
      tbody.innerHTML = filtered.map(p => `
        <tr>
          <td>#${p.id}</td>
          <td>
            <div style="font-weight:900;">${p.name}</div>
            <div style="font-size:12px; color:var(--text-dim);">${p.owner_email || 'Ø¨Ø¯ÙˆÙ† Ø¨Ø±ÙŠØ¯'}</div>
          </td>
          <td><span class="badge ${p.subscription_status === 'pending' ? 'bg-pending' : 'bg-active'}">${p.subscription_status === 'pending' ? 'Ø¨Ø§Ù†ØªØ¸Ø§Ø± ØªÙØ¹ÙŠÙ„' : 'Ù†Ø´Ø·'}</span></td>
          <td style="color:var(--success); font-weight:900;">$${(p.payment_total || 0).toFixed(2)}</td>
          <td>
            <div style="display:flex; gap:8px;">
                <button class="btn-action" onclick="openEditModal(${p.id})" style="background:var(--primary); color:#fff;" title="ØªØ¹Ø¯ÙŠÙ„ Ø´Ø§Ù…Ù„"><i class="fa-solid fa-pen"></i></button>
                <button class="btn-action" onclick="openModal(${p.id})" style="background:var(--success); color:#fff;" title="ØªÙØ¹ÙŠÙ„/ØªØ¬Ø¯ÙŠØ¯"><i class="fa-solid fa-check"></i></button>
                <button class="btn-action" onclick="deletePlace(${p.id})" style="background:none; border:1px solid var(--danger); color:var(--danger);" title="Ø­Ø°Ù Ù†Ù‡Ø§Ø¦ÙŠ"><i class="fa-solid fa-trash"></i></button>
            </div>
          </td>
        </tr>
      `).join('');
    }

    // 4. ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„ ÙˆØªØ¹Ø¨Ø¦Ø© ÙƒØ§ÙØ© Ø§Ù„Ø­Ù‚ÙˆÙ„ Ø§Ù„Ù€ 15 Ø¨Ø¯Ù‚Ø©
    function openEditModal(id) {
      const p = allPlaces.find(i => i.id === id);
      if(!p) return;

      document.getElementById("edit_id").value = p.id;
      document.getElementById("edit_name").value = p.name || "";
      document.getElementById("edit_category").value = p.category || "";
      document.getElementById("edit_area").value = p.area || "";
      document.getElementById("edit_address").value = p.address || "";
      document.getElementById("edit_phone").value = p.phone || "";
      document.getElementById("edit_whatsapp").value = p.whatsapp || "";
      document.getElementById("edit_facebook").value = p.facebook || "";
      document.getElementById("edit_instagram").value = p.instagram || "";
      document.getElementById("edit_website").value = p.website || "";
      document.getElementById("edit_open_hours").value = p.open_hours || "";
      document.getElementById("edit_lat").value = p.latitude || "";
      document.getElementById("edit_lng").value = p.longitude || "";
      document.getElementById("edit_description").value = p.description || "";
      document.getElementById("edit_tags").value = p.tags || "";
      
      // Ø¹Ø±Ø¶ Ø§Ù„ØµÙˆØ± Ø§Ù„Ø­Ø§Ù„ÙŠØ© Ù…Ø¹ Ø²Ø± Ø­Ø°Ù
      document.getElementById("edit_images_container").innerHTML = (p.images || []).map(img => `
        <div style="position:relative; width:70px; height:70px;">
            <img src="${img.image_url}" style="width:100%; height:100%; border-radius:10px; object-fit:cover; border:1px solid var(--border);">
            <button onclick="delImg(${img.id})" style="position:absolute; top:-5px; right:-5px; background:var(--danger); color:white; border:none; border-radius:50%; width:20px; height:20px; cursor:pointer; font-size:10px; font-weight:bold;">X</button>
        </div>
      `).join('');

      document.getElementById("editPlaceModal").style.display = "flex";
      document.getElementById("edit_is_premium").checked = p.is_premium || false;
    }

    // 5. Ø­ÙØ¸ ÙƒØ§ÙØ© Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª (Ø¥Ø±Ø³Ø§Ù„ ÙƒÙ„ Ø§Ù„Ø®Ø§Ù†Ø§Øª Ù„Ù„Ø³ÙŠØ±ÙØ±)
    async function saveEdit() {
      const id = document.getElementById("edit_id").value;
      const payload = {
        name: document.getElementById("edit_name").value,
        category: document.getElementById("edit_category").value,
        area: document.getElementById("edit_area").value,
        address: document.getElementById("edit_address").value,
        phone: document.getElementById("edit_phone").value,
        whatsapp: document.getElementById("edit_whatsapp").value,
        facebook: document.getElementById("edit_facebook").value,
        instagram: document.getElementById("edit_instagram").value,
        website: document.getElementById("edit_website").value,
        open_hours: document.getElementById("edit_open_hours").value,
        latitude: parseFloat(document.getElementById("edit_lat").value) || null,
        longitude: parseFloat(document.getElementById("edit_lng").value) || null,
        description: document.getElementById("edit_description").value,
        tags: document.getElementById("edit_tags").value
      };

      const res = await fetch(`/api/places/${id}`, { 
        method: "PUT", 
        headers: { "Content-Type": "application/json", "x-admin-token": adminToken }, 
        body: JSON.stringify(payload) 
      });

      const files = document.getElementById("edit_new_images").files;
      if(files.length > 0) {
        const fd = new FormData();
        for(let f of files) fd.append("images", f);
        await fetch(`/api/places/${id}/images`, { 
          method: "POST", 
          headers: { "x-admin-token": adminToken }, 
          body: fd 
        });
      }

      if(res.ok) { 
        alert("âœ… ØªÙ… Ø§Ù„ØªØ­Ø¯ÙŠØ« Ø¨Ù†Ø¬Ø§Ø­."); 
        location.reload(); 
      }
    }

    // 6. ÙˆØ¸ÙŠÙØ© Ø­Ø°Ù ØµÙˆØ±Ø©
    async function delImg(id) {
        if(confirm("Ø­Ø°Ù Ù‡Ø°Ù‡ Ø§Ù„ØµÙˆØ±Ø© Ù†Ù‡Ø§Ø¦ÙŠØ§Ù‹ØŸ")) {
            await fetch(`/api/places/images/${id}`, { 
                method: "DELETE", 
                headers: { "x-admin-token": adminToken } 
            });
            location.reload();
        }
    }
    async function deletePlace(id) {
        if(confirm("Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ø­Ø°Ù Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ Ù„Ù„Ù…Ù†Ø´Ø£Ø© ÙˆÙƒØ§ÙØ© ØµÙˆØ±Ù‡Ø§ØŸ")) {
            const res = await fetch(`/api/places/${id}`, { method: "DELETE", headers: { "x-admin-token": adminToken } });
            if (res.ok) loadData();
        }
    }

    function openModal(id) { document.getElementById("targetId").value = id; document.getElementById("activateModal").style.display = "flex"; }
    function closeModal() { document.getElementById("activateModal").style.display = "none"; }
    function closeEditModal() { document.getElementById("editPlaceModal").style.display = "none"; }

    async function confirmActivation() {
      const id = document.getElementById("targetId").value;
      const m = document.getElementById("subMonths").value;
      const a = document.getElementById("subAmount").value;
      if(!a) return alert("ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ù…Ø³ØªÙ„Ù…");

      await fetch(`/api/places/${id}/activate`, { 
        method: "POST", 
        headers: { "Content-Type": "application/json", "x-admin-token": adminToken }, 
        body: JSON.stringify({ months: parseInt(m), amount: parseFloat(a) }) 
      });
      alert("âœ… ØªÙ… Ø§Ù„ØªÙØ¹ÙŠÙ„ Ø¨Ù†Ø¬Ø§Ø­."); location.reload();
    }

    function logout() {
      sessionStorage.removeItem("admin_token");
      window.location.href = "/static/admin-login.html";
    }

    window.onload = loadData;
  </script>
</body>
</html>